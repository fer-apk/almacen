<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Usuario - Productos</title>
    <style>
      :root { color-scheme: light dark; }
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial; margin: 0; background: #f6f7f9; color: #111; }
      header { display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; background: white; border-bottom: 1px solid #e5e7eb; position: sticky; top: 0; }
      .title { font-weight: 600; }
      .back { margin-left: auto; }
      .btn { padding: 8px 12px; border-radius: 8px; border: 1px solid #d1d5db; background: #fff; cursor: pointer; }
      main { max-width: 960px; margin: 20px auto; padding: 0 16px; }
      .card { background: #fff; border: 1px solid #e5e7eb; border-radius: 12px; overflow: hidden; box-shadow: 0 10px 25px rgba(0,0,0,.05); }
      .card-header { padding: 12px 16px; border-bottom: 1px solid #e5e7eb; font-weight: 600; }
      table { width: 100%; border-collapse: collapse; }
      thead th { text-align: left; background: #fafafa; border-bottom: 1px solid #e5e7eb; padding: 10px 12px; font-size: 14px; }
      tbody td { border-bottom: 1px solid #f0f2f5; padding: 10px 12px; font-size: 14px; }
      .muted { color: #6b7280; }
      .status { margin: 12px 0; font-size: 14px; }
    </style>
  </head>
  <body>
    <header>
      <div class="title">Vista de Usuario</div>
      <a class="back" href="/login"><button class="btn">Volver al login</button></a>
    </header>
    <main>
      <div class="card">
        <div class="card-header">Productos registrados</div>
        <div style="padding: 12px 16px">
          <div id="status" class="status muted">Cargando productos...</div>
          <div style="overflow-x:auto">
            <table id="tabla">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Nombre</th>
                  <th>Descripci√≥n</th>
                  <th>Precio</th>
                  <th>Stock</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </main>
    <script>
      async function cargarProductos() {
        const status = document.getElementById('status');
        const tbody = document.querySelector('#tabla tbody');
        tbody.innerHTML = '';
        try {
          const res = await fetch('/api/productos');
          const json = await res.json();
          if (!res.ok || !json.ok) throw new Error(json.message || 'Error al cargar');
          const productos = json.data || [];
          if (productos.length === 0) {
            status.textContent = 'No hay productos registrados';
            status.className = 'status muted';
            return;
          }
          status.textContent = `Mostrando ${productos.length} producto(s)`;
          status.className = 'status muted';
          for (const p of productos) {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${p.id_producto}</td>
              <td>${p.nombre}</td>
              <td class="muted">${p.descripcion ?? ''}</td>
              <td>$${Number(p.precio).toFixed(2)}</td>
              <td>${p.stock}</td>
            `;
            tbody.appendChild(tr);
          }
        } catch (err) {
          status.textContent = err.message || 'Error del servidor';
          status.className = 'status';
        }
      }

      document.addEventListener('DOMContentLoaded', cargarProductos);
    </script>
  </body>
</html>
