<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Login - Almacén</title>
    <style>
      :root { color-scheme: light dark; }
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; margin: 0; padding: 0; display: grid; place-items: center; min-height: 100vh; background: #f6f7f9; }
      .card { background: white; padding: 24px; border-radius: 12px; width: 100%; max-width: 360px; box-shadow: 0 10px 25px rgba(0,0,0,.08); }
      h1 { margin: 0 0 12px; font-size: 20px; }
      p { margin: 0 0 16px; color: #666; }
      label { display: block; font-size: 14px; margin-bottom: 6px; }
      input { width: 100%; padding: 10px 12px; border: 1px solid #dce0e6; border-radius: 8px; font-size: 14px; }
      .row { margin-bottom: 14px; }
      button { width: 100%; padding: 10px 14px; background: #0d6efd; color: white; border: none; border-radius: 8px; font-size: 15px; cursor: pointer; }
      button:disabled { opacity: .7; cursor: not-allowed; }
      .msg { margin-top: 12px; font-size: 14px; }
      .ok { color: #0a7b35; }
      .err { color: #b00020; }
    </style>
  </head>
  <body>
    <main class="card">
      <h1>Iniciar sesión</h1>
      <p>Ingrese sus credenciales</p>
      <form id="loginForm">
        <div class="row">
          <label for="usuario">Usuario</label>
          <input id="usuario" name="usuario" autocomplete="username" required />
        </div>
        <div class="row">
          <label for="password">Contraseña</label>
          <input id="password" name="password" type="password" autocomplete="current-password" required />
        </div>
        <button id="submitBtn" type="submit">Entrar</button>
        <div id="msg" class="msg"></div>
      </form>
    </main>
    <script>
      const form = document.getElementById('loginForm');
      const msg = document.getElementById('msg');
      const submitBtn = document.getElementById('submitBtn');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        msg.textContent = '';
        msg.className = 'msg';
        submitBtn.disabled = true;

        const data = {
          usuario: form.usuario.value.trim(),
          password: form.password.value,
        };

        try {
          const res = await fetch('/api/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data),
          });

          const json = await res.json();
          if (!res.ok || !json.ok) {
            throw new Error(json.message || 'Error de autenticación');
          }
          msg.textContent = `Bienvenido, ${json.user.nombre} (${json.user.rol})`;
          msg.className = 'msg ok';
        } catch (err) {
          msg.textContent = err.message || 'Error del servidor';
          msg.className = 'msg err';
        } finally {
          submitBtn.disabled = false;
        }
      });
    </script>
  </body>
</html>
